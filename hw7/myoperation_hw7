Script started on Thu Nov 28 18:42:45 2024
]0;41147011S@telnet: ~/SystemSoftware41147011S@telnet:~/SystemSoftware$ exitcat result.txt[2P./wc_programcat result.txt[2P./wc_programgcc -o wc_program wc_program.c[15Pcat example.txtexit[Kcat example.txtgcc -o wc_program wc_program.c[18P./wc_programcat result.txtexit[K[Kexitcat result.txt[2P./wc_programcat result.txt[K[K[K[K[K[K[K[K[K[Kwc_program.c
#include <stdio.h>
#include <stdlib.h>
#include <fcntl.h>
#include <unistd.h>
#include <sys/wait.h>

int main() {
    char filename[100];
    printf("è«‹è¼¸å…¥æª”æ¡ˆåç¨±ï¼š");
    scanf("%s", filename);

    // é–‹å•Ÿè¦åˆ†æçš„æª”æ¡ˆ
    int input_fd = open(filename, O_RDONLY);
    if (input_fd < 0) {
        perror("ç„¡æ³•é–‹å•Ÿæª”æ¡ˆ");
        return 1;
    }

    // å‰µå»ºå„²å­˜çµæœçš„æª”æ¡ˆ
    int output_fd = open("result.txt", O_WRONLY | O_CREAT | O_TRUNC, 0644);
    if (output_fd < 0) {
        perror("ç„¡æ³•å‰µå»ºçµæœæª”æ¡ˆ");
        close(input_fd);
        return 1;
    }

    // ä½¿ç”¨ fork() å‰µå»ºå­ç¨‹åº
    pid_t pid = fork();
    if (pid < 0) {
        perror("fork éŒ¯èª¤");
        close(input_fd);
        close(output_fd);
        return 1;
    }

    if (pid == 0) { 
        // å­ç¨‹åºï¼šåŸ·è¡Œ `wc` æŒ‡ä»¤
        dup2(input_fd, STDIN_FILENO);   // å°‡æ¨™æº–è¼¸å…¥é‡å®šå‘åˆ°è¦åˆ†æçš„æª”æ¡ˆ
        dup2(output_fd, STDOUT_FILENO); // å°‡æ¨™æº–è¼¸å‡ºé‡å®šå‘åˆ°çµæœæª”æ¡ˆ

        close(input_fd);
        close(output_fd);

        // åŸ·è¡Œ wc æŒ‡ä»¤
        execlp("wc", "wc", (char *)NULL);

        // å¦‚æœ execlp åŸ·è¡Œå¤±æ•—
        perror("åŸ·è¡Œ wc éŒ¯èª¤");
        exit(1);
    } else { 
        // ä¸»ç¨‹åºï¼šç­‰å¾…å­ç¨‹åºçµæŸ
        wait(NULL);

        // é—œé–‰æ–‡ä»¶æè¿°ç¬¦
        close(input_fd);
        close(output_fd);

        // è®€å–çµæœæª”æ¡ˆä¸¦é¡¯ç¤ºå…§å®¹
        int result_fd = open("result.txt", O_RDONLY);
        if (result_fd < 0) {
            perror("ç„¡æ³•é–‹å•Ÿçµæœæª”æ¡ˆ");
            return 1;
        }

        char buffer[1024];
        ssize_t bytes_read;
        printf("çµæœç‚ºï¼š\n");
        while ((bytes_read = read(result_fd, buffer, sizeof(buffer) - 1)) > 0) {
            buffer[bytes_read] = '\0';
            printf("%s", buffer);
        }

        close(result_fd);
    }

    return 0;
}

]0;41147011S@telnet: ~/SystemSoftware41147011S@telnet:~/SystemSoftware$ cat wc_program.cexit[Kcat result.txt[2P./wc_programgcc -o wc_program wc_program.c[15Pcat example.txt
Hello world
This is a test file

]0;41147011S@telnet: ~/SystemSoftware41147011S@telnet:~/SystemSoftware$ gcc -o wc_program wc_program.c
]0;41147011S@telnet: ~/SystemSoftware41147011S@telnet:~/SystemSoftware$ ./wc_program
è«‹è¼¸å…¥æª”æ¡ˆåç¨±ï¼šexample.txt
çµæœç‚ºï¼š
 3  7 33
]0;41147011S@telnet: ~/SystemSoftware41147011S@telnet:~/SystemSoftware$ cat result.txt
 3  7 33
]0;41147011S@telnet: ~/SystemSoftware41147011S@telnet:~/SystemSoftware$ exit
exit

Script done on Thu Nov 28 18:44:20 2024
